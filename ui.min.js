function $(e){return document.getElementById(e)}function loadpic(e){$("uploadpic").setAttribute("onclick",`uploadpic("${e}")`),$("imagedetails").innerHTML=`Make sure you upload for <h5>${e}</h5>`,fetch(`uploads/${e}`).then(e=>{if(e.ok)return e.text();throw new Error}).then(e=>{$("image").src=e}).catch(e=>{$("image").src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/195px-No-Image-Placeholder.svg.png"})}function chosenpic(){const e=document.getElementById("file").files[0];e&&($("image").src=URL.createObjectURL(e))}function uploadpic(e){const t=document.createElement("canvas"),a=t.getContext("2d");t.width=500,t.height=300,a.drawImage($("image"),0,0,500,300);const s=t.toDataURL();try{$("uploadpicinfo").innerHTML+=`<div id="uploadingpic" class="alert alert-primary alert-dismissible fade show">\n                Uploading for ${e}\n                <div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div></div>\n                <button class="close" data-dismiss="alert">&times;</button>\n                </div>`,jQuery.ajax({type:"POST",url:"save.php",data:{content:s,filename:e,mode:"pic"},success:e=>{$("uploadingpic").remove(),$("uploadpicinfo").innerHTML+='<div class="alert alert-success alert-dismissible fade show">\n                <strong>Uploaded!</strong> Thank you for contributing :-)\n                <button class="close" data-dismiss="alert">&times;</button>\n                </div>'}})}catch(e){$("uploadpicinfo").innerHTML+='<div class="alert alert-danger alert-dismissible fade show">\n            <strong>Error occured!</strong> Please try again.\n            <button class="close" data-dismiss="alert">&times;</button>\n            </div>'}}function uploaddata(e,t,a){jQuery.ajax({type:"POST",url:"save.php",data:{content:e,filename:t,mode:a}})}function generateexport(){$("export").href=window.URL.createObjectURL(new Blob([localStorage.favorites],{type:"text/plain"})),$("whatsapp").href=`https://wa.me?text=${encodeURIComponent(localStorage.favorites)}`,$("sharewhatsapp").href=`https://wa.me?text=${encodeURIComponent("See IIITH mess menu easily with this site: https://sohamapps.rf.gd/mess/")}`}function goto(e){const[t,a,s]=e.innerText.split(" > ");dateset(a),updateDOM(t,s)}function heart(e,t,a=!0){a?favorites.includes(t)||favorites.push(t):favorites=favorites.filter(e=>e!=t),localStorage.favorites=favorites.join("\n"),generateexport(),updateDOM()}function updateDOM(e=null,t=null){selectedmess=e||localStorage.selected||"All",localStorage.selected=selectedmess,todaysfavorites(),updatebuttonactivestates();let a,s="";for(let e in table)if("All"==selectedmess||e==selectedmess){s+="<tr>","All"==selectedmess&&(s+=`<th><h3>${e}</h3></th>`);for(let l of slots){a=0;const i=`${selectedday} > ${e} > ${l}`;let o='<table class="mx-2 mb-2">';favorites.includes(i)?o+=`<i data-toggle="button" class="col border-0 btn btn-outline-danger fa fa-heart active" onclick="heart(this,'${i}',0)"></i>`:o+=`<i data-toggle="button" class="col border-0 btn btn-outline-danger fa fa-heart" onclick="heart(this,'${i}')"></i>`,o+=`<th>${l}</th>`;for(let s of table[e][l]){if(o+="<tr>",s[1]){+localStorage.showcategories&&(o+=`<th>${clean(s[0])}</th>`);const e=s[1].replaceAll("\n","<br>");let l=e;t&&(l=l.replace(new RegExp(t,"ig"),"<mark>$&</mark>")),l=l.replace(new RegExp("(.*)\\*$","gm"),'$1 <button class="btn btn-sm btn-success" disabled>New</button>'),l=l.replaceAll("\n","<br>"),itemlink=`<a href="#" data-toggle="modal" data-target="#rating"\n                        onclick="document.getElementById('ratingslot').innerText='${i} > ${clean(s[0])}';document.getElementById('ratingitem').innerText='${e}'"\n                        >${l}</a>`;const n=`${i} > ${clean(s[0])} > ${e}`;if(ratings[n]){const e=ratings[n].rating,t=ratings[n].users;let a="bg-secondary";e<=2.5?a="bg-danger":e<=3.5?a="bg-warning":e<=4.5?a="bg-info":e<=5&&(a="bg-success"),o+=`<td>${itemlink} <span class="badge rounded-pill ${a}">${Math.round(e,1)} <i class="fa fa-star"></i> (${t})</span></td>`}else o+=`<td>${itemlink}</td>`;a++}else+localStorage.showblankcategories&&(o+=`<td><strike>${clean(s[0])}</strike></td>`,a++);o+="</tr>"}o+="</table>",a?(s+=`<td class="${l==upcoming?"table-primary":""} ${favorites.includes(i)?"table-danger":""}">`,s+=o+"</td>"):s+="<td></td>"}s+="</tr>"}s="<tr><td></td><td></td><td></td><td></td></tr>"==s?`<h2>No favorites in '${selectedmess}' :-(</h2>`:`<tbody class="slots">${s}</tbody>`,$("table").innerHTML=s}function showfavorites(){let e="";for(let t of favorites){const a=t.split(" > ");e+=`<li><a href="#" onclick="goto(this)">${[a[1],a[0],a[2]].join(" > ")}</a></li>`}$("favoriteslist").innerHTML=e||'<div class="alert alert-info">Click on <i class="fa-regular fa-heart"></i> to favorite an item.</div>',uploaddata(favorites.join("\n"),"anon","fav")}function populatemesses(){let e='<li class="page-item"><a class="page-link" href="#" onclick="updateDOM(\'All\')">All</a></li>';for(let t in messes)e+=`<li class="page-item"><a class="page-link" href="#" onclick="updateDOM('${t}')">${t}</a></li>`;$("messes").innerHTML=e}function populatedays(){let e="";for(let t of week)e+=`<li class="page-item"><a class="page-link ${t.slice(0,3)==selectedday.slice(0,3)?"rounded-circle":""}" href="#" onclick="dateset('${t}')" data-day="${t}">${t.slice(0,3)}</a></li>`;$("days").innerHTML=e}function populatesearchresults(e,t,a){let s="";for(let t of e)s+=`<li><a href="#" onclick="goto(this)">${t.replace(new RegExp(a.join("|"),"ig"),"<mark>$&</mark>")}</a></li>`;$("table").innerHTML=e.length?`<h2>${e.length} results found for '${t}'</h2><ul>${s}</ul>`:`<h2>'${t}' not found in menu :(</h2>`}function populatemeals(e){let t="",a=!0;for(let s in e){let l="";s==upcoming?(a=!1,l=s==ongoing?'<i class="fa fa-lock-open text-success"></i>':'<i class="fa fa-lock text-success"></i>'):a&&(l='<i class="fa fa-check-double text-info"></i>'),t+=`<tr class="${s==upcoming?"table-primary":""}"><th>${s}</th><td>${e[s]} ${l}</td></tr>`}let s=`<h2>${timemsg}</h2>`;ongoing&&(s+=`<div class="progress"><div style="width:${(timeslot[2]-timeslot[0])/(timeslot[1]-timeslot[0])*100}%;" id="progress" class="progress-bar progress-bar-striped progress-bar-animated"></div></div>`),$("msg").innerHTML=s;let l="";l=(new Date).toLocaleDateString("en-us",{weekday:"long"})==selectedday?"Today":selectedday,$("meals").innerHTML=`<h5>${l}'s favorites</h5>\n    <table id="meals" class="table table-bordered"><tbody>${t}</tbody></table>`,populatewef()}function updatebuttonactivestates(){for(let e of $("days").children)e.children[0].getAttribute("data-day")==selectedday?e.classList.add("active"):e.classList.remove("active");for(let e of $("messes").children)e.children[0].innerText==selectedmess?e.classList.add("active"):e.classList.remove("active")}function populatewef(){let e="";for(let t in messes)t==selectedmess&&(e+=`<h5 class="text-success">Last updated on ${messes[t].wef}</h5>`);$("wef").innerHTML=e}$("showblankcategories").checked=+localStorage.showblankcategories?1:0,$("showcategories").checked=+localStorage.showcategories?1:0;