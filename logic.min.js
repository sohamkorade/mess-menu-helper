function dismissNewAlert(e){e.parentElement.style.display="none",localStorage.setItem("dismissedNewAlert","true")}function clean(e){return e.replace(/__\d+/,"")}function dateadd(e){e?date.setDate(date.getDate()+e):date=new Date,loadtable(date),updateDOM()}function dateset(e){date=new Date;for(let t=0;t<7&&date.toLocaleDateString("en-us",{weekday:"long"})!=e;t++)date.setDate(date.getDate()+1);loadtable(date),updateDOM()}function setCheck(e){localStorage[e.id]=e.checked?1:0,updateDOM()}function loadtable(e){const t=new Date(e),s=t.getDay();selectedday=t.toLocaleDateString("en-us",{weekday:"long"});for(let e in messes){table[e]={};const t=Object.entries(messes[e].menu[(s-weekdayoffset+7)%7]).slice(1);let n=0;for(let s in messes[e].sections)slots.includes(s)||slots.push(s),table[e][s]=t.slice(n,n+=messes[e].sections[s][0])}}function hmin(e){e=(e%24+24)%24;const t=Math.floor(e),s=Math.round(60*(e-t));return`${t?`${t} h`:""} ${s?`${s} min`:""}`}function updateTimeleft(e=!1){"All"==selectedmess&&(selectedmess=Object.keys(messes)[0]),timeslot=[];const t=date,s=t.getHours()+t.getMinutes()/60,n=messes[selectedmess].sections;let a,o;upcoming=ongoing="";for(let e in n){if(a=n[e][1],o=n[e][2],s<a){timemsg=`${e} opening in ${hmin(n[e][1]-s)}`,upcoming=e;break}if(s<=o){timemsg=`${e} closing in ${hmin(o-s)}`,ongoing=upcoming=e,timeslot=[a,o,s];break}}if(""==upcoming){let e=Object.keys(n)[0];timemsg=`${e} opening in ${hmin(n[e][1]-s)}`,upcoming=e}updateDOM(),e&&setTimeout(updateTimeleft,6e4,!0)}function searchquery(e){if(e.length<3)updateDOM();else{let t=[];const s=e.trim().split(" ");for(let e in messes)for(let n in messes[e].menu)for(let a in messes[e].menu[n])s.every(t=>messes[e].menu[n][a].match(new RegExp(t,"i")))&&t.push([e,week[(+n+weekdayoffset+7)%7],messes[e].menu[n][a]].join(" > "));populatesearchresults(t,e,s)}}function todaysfavorites(){let e={};for(let t of slots)e[t]=[];for(let t of favorites){const[s,n,a]=t.split(" > ");s==selectedday&&e[a].push(n)}populatemeals(e)}function rate(e,t){const s=document.getElementById("ratingslot").innerText+" > "+document.getElementById("ratingitem").innerText;console.log(s,t);const n=e.parentElement.children;let a;for(a=0;a<t;a++)n[a].classList.remove("text-secondary"),n[a].classList.add("text-warning");for(;a<n.length;a++)n[a].classList.remove("text-warning"),n[a].classList.add("text-secondary");const o="post_rating.php?"+new URLSearchParams({food_name:s,stars:t});console.log(s,o),fetch(o).then(e=>e.text()).then(e=>{document.getElementById("ratingthanks").innerText="Thank you for your feedback!",load_ratings().then(e=>{updateDOM()})}).catch(e=>{document.getElementById("ratingthanks").innerText="Failed to send feedback. Please try again later."})}function reset_rating_modal(){const e=document.getElementById("ratingstars").children;for(let t=0;t<e.length;t++)e[t].classList.remove("text-warning"),e[t].classList.add("text-secondary");document.getElementById("ratingthanks").innerText=""}async function load_ratings(){ratings={},await fetch("ratings.txt").then(e=>e.text()).then(e=>{const t=e.split("\n");for(let e of t){const[t,s,n]=e.split("\t");'"'==t[0]&&'"'==t[t.length-1]?ratings[t.slice(1,-1)]={rating:s,users:n}:ratings[t]={rating:s,users:n}}})}const week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],table={};let favorites=[],messes={},date=new Date,weekdayoffset=1,selectedday="",timemsg="",ongoing="",upcoming="",timeslot=[],slots=[],selectedmess="All",ratings={};fetch("data6.json").then(e=>e.json()).then(e=>{messes=e.messes,weekdayoffset=e.weekdayoffset,populatemesses(),dateadd(0),populatedays(),updateTimeleft(!0),load_ratings().then(e=>{updateDOM()})}),localStorage.favorites&&(favorites=localStorage.favorites.split("\n"),generateexport()),localStorage.dismissedNewAlert&&(document.getElementById("newalert").style.display="none");