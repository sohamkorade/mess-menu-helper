function clean(e){return e.replace(/__\d+/,"")}function dateadd(e){e?date.setDate(date.getDate()+e):date=new Date,loadtable(date),updateDOM()}function dateset(e){date=new Date;for(let t=0;t<7&&date.toLocaleDateString("en-us",{weekday:"long"})!=e;t++)date.setDate(date.getDate()+1);loadtable(date),updateDOM()}function setCheck(e){localStorage[e.id]=e.checked?1:0,updateDOM()}function loadtable(e){const t=new Date(e),s=t.getDay();selectedday=t.toLocaleDateString("en-us",{weekday:"long"});for(let e in messes){table[e]={};const t=Object.entries(messes[e].menu[(s-weekdayoffset+7)%7]).slice(1);let a=0;for(let s in messes[e].sections)slots.includes(s)||slots.push(s),table[e][s]=t.slice(a,a+=messes[e].sections[s][0])}}function hmin(e){e=(e%24+24)%24;const t=Math.floor(e),s=Math.round(60*(e-t));return`${t?`${t} h`:""} ${s?`${s} min`:""}`}function updateTimeleft(e=!1){"All"==selectedmess&&(selectedmess=Object.keys(messes)[0]),timeslot=[];const t=date,s=t.getHours()+t.getMinutes()/60,a=messes[selectedmess].sections;let n,o;upcoming=ongoing="";for(let e in a){if(n=a[e][1],o=a[e][2],s<n){timemsg=`${e} opening in ${hmin(a[e][1]-s)}`,upcoming=e;break}if(s<=o){timemsg=`${e} closing in ${hmin(o-s)}`,ongoing=upcoming=e,timeslot=[n,o,s];break}}if(""==upcoming){let e=Object.keys(a)[0];timemsg=`${e} opening in ${hmin(a[e][1]-s)}`,upcoming=e}updateDOM(),e&&setTimeout(updateTimeleft,6e4,!0)}function searchquery(e){if(e.length<3)updateDOM();else{let t=[];const s=e.trim().split(" ");for(let e in messes)for(let a in messes[e].menu)for(let n in messes[e].menu[a])s.every(t=>messes[e].menu[a][n].match(new RegExp(t,"i")))&&t.push([e,week[(+a+weekdayoffset+7)%7],messes[e].menu[a][n]].join(" > "));populatesearchresults(t,e,s)}}function todaysfavorites(){let e={};for(let t of slots)e[t]=[];for(let t of favorites){const[s,a,n]=t.split(" > ");s==selectedday&&e[n].push(a)}populatemeals(e)}function rate(e,t){console.log(e.parentElement.getAttribute("data-rating"),t);const s=e.parentElement.children;let a;for(a=0;a<t;a++)s[a].classList.remove("text-secondary"),s[a].classList.add("text-warning");for(;a<s.length;a++)s[a].classList.remove("text-warning"),s[a].classList.add("text-secondary")}const week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],table={};let favorites=[],messes={},date=new Date,weekdayoffset=1,selectedday="",timemsg="",ongoing="",upcoming="",timeslot=[],slots=[],selectedmess="All";fetch("data3.json").then(e=>e.json()).then(e=>{messes=e.messes,weekdayoffset=e.weekdayoffset,populatemesses(),dateadd(0),populatedays(),updateTimeleft(!0)}),localStorage.favorites&&(favorites=localStorage.favorites.split("\n"),generateexport());